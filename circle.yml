version: 2.1
jobs:
    build:
        docker:
            # specify the version you desire here
            - image: circleci/node:latest-browsers
        environment:
            NPM_CONFIG_LOGLEVEL: error
            JOBS: max # https://gist.github.com/ralphtheninja/f7c45bdee00784b41fed
        branches:
            ignore:
                - gh-pages # list of branches to ignore
                - /release\/.*/ # or ignore regexes

        # working_directory: ~/

        steps:
            - checkout
            - restore_cache:
                  key: node-modules-{{ checksum "package.json" }}
            - run: sudo npm install -g cnpm
            - run: cnpm install --registry=https://registry.npmjs.org
            - run: cnpm run coveralls
            - save_cache:
                key: node-modules-{{ checksum "package.json" }}
                paths:
                    - ./node_modules
