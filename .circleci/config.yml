version: 2
jobs:
    test:
        docker:
            # specify the version you desire here
            - image: circleci/node:latest-browsers
        environment:
            NPM_CONFIG_LOGLEVEL: error
            JOBS: max # https://gist.github.com/ralphtheninja/f7c45bdee00784b41fed
        branches:
            only:
                - master
                - develop
        working_directory: ~/micro-app
        steps:
            - checkout
            - restore_cache:
                  key: micro-app-core-{{ CIRCLE_BRANCH }}-{{ checksum "yarn.lock" }}
            - run: yarn --network-timeout 600000
            - run: yarn run coveralls
            - save_cache:
                key: micro-app-core-{{ CIRCLE_BRANCH }}-{{ checksum "yarn.lock" }}
                paths:
                    - ./node_modules
